                                                        /////////////////MAIN STARTS////////////////////////////                                                        main();                                                        function main(){                                                         var fileSep = "/";                                                                                                                 //Where fileSep is "/" you can change it though if you are on windows.                                                        if(File.fs=="Windows")                                                        {                                                             fileSep = "\\";                                                        }                                                        ///////END OF DIALOG////////////////////////////////////////////////                                                        //////DITANATION STARTS HERE//////////////////////////////////////                                                                                                                var myDoc = app.activeDocument;                                                        /////OPENS THE XML FILE////////////////////////////////                                                        filename = '';                                                        try{                                                          function maskFile(myFile) {                                                          if (myFile.constructor.name == "Folder") { return true }                                                          if (myFile.name.slice(-4) == ".xml") { return true }                                                          return false;                                                          }                                                          filename = File.openDialog("GET YOUR XML FILE", maskFile);                                                          myDoc.importXML(filename);                                                                                                          }                                                         catch(e){ exit();                                                         };                                                                                                                    ///////////DOC PREP --- TEST IF THE DOCUMENTS IS AN EMPTY DOCUMENT///////////////                                                                                                                                                                            ///////////////MY GLOBAL XML VARIABLES///////////////////////////////////////////////                                                                                                                  var xml = myDoc.xmlElements[0];                                                                                                                   //////*****MAKES XPATH HAPPY AND COOPERATIVE*****//////////////////////////////////////~                                                                                                                if( !xml.xmlAttributes.itemByName("xmlns:xml").isValid )                                                        xml.xmlAttributes.add( "xmlns:xml", "http://www.w3.org/XML/1998/namespace" );                                                        if( !xml.xmlAttributes.itemByName("xmlns:aid").isValid )                                                        xml.xmlAttributes.add( "xmlns:aid", "http://ns.adobe.com/Adobe InDesign/4.0/" );                                                        if( !xml.xmlAttributes.itemByName("xmlns:aid5").isValid )                                                        xml.xmlAttributes.add( "xmlns:aid5", "http://ns.adobe.com/Adobe InDesign/5.0/" );                                                                                                                /////////////////////////////////////////////////////////////////////////////////////////////                                                                                                                   var pageNode= xml.evaluateXPathExpression("//page");                                                       var minPage = pageNode[0].xmlAttributes.item('value').value;                                                       var maxPage =0;//~                                                        alert(pageNode[0].xmlAttributes.itemByName("value").value);                                                       var myContent = xml.evaluateXPathExpression("//*[contains(@class,' topic/topic ')]");                                                       var bookmap = xml.evaluateXPathExpression('bookmap');                                                                                                              /////////SET THE START PAGE NUMBER/////////////////////////////////////////////////////////                                                       myDoc.documentPreferences.startPageNumber  = parseInt(minPage);                                                        ////////CREATE DOCUMENT PAGES////////////////////////////////////////////////////////////                                                       for(x=1;x < myContent.length; x++){                                                                                                                          try{                                                                var page = pageNode[x].xmlAttributes.itemByName("value").value;                                                                //alert(page);                                                                maxPage = Math.max(page,maxPage);                                                                }                                                                catch(e){                                                                             page = "dita "+ x + " no page specified";                                                                }                                                                }                                                                // add that many pages                                                                                                                  for (x=minPage; x <= maxPage-1;x++){                                                                                                                              myPage = myDoc.pages.add();                                                               }                                                                                                            ////////////////////////////POURS XML IN///////////////////////////////////////////////////////////////////////////////                                                                                                        for (i = 0; i < pageNode.length; i++){                                                         try{                                                        if(myContent[i].xmlContent.parent.name==""){                                                                                                                var page = pageNode[i].xmlAttributes.itemByName("value").value;                                                        //alert(page);                                                        var nodeLabel = myContent[i].xmlAttributes.itemByName("outputclass").value;                                                        myContent[i].placeXML(addTextFrame(myDoc.pages[page-parseInt(minPage)], nodeLabel))                                                        }                                                        }                                                        catch(e){}                                                        }//~                                                                                                                                                                                 /////RE IMPORTS THE XML FILE FOR PROPER STYLING/////////////////////////////////                                                                                                                        myDoc.importXML(filename);                                                                                                                      ////RUNS TABLENATOR FOR PROPER TABLE WIDTH AND NO EXTRA RETURNS INSIDE TABLES/////////////////////////////////                                                          try{//~                                                          app.doScript(new File(app.activeScript.parent.fsName+fileSep+"objectStyles.jsx"), ScriptLanguage.javascript);                                                         app.doScript(new File(app.activeScript.parent.fsName+fileSep+"Tablenator.jsx"), ScriptLanguage.javascript);                                                          }                                                      catch(e){}                                                       ///end of main////                                                             }                                                     /////MY FUNCTIONS/////////////////////////////////////////////////////////////////////////////////////////////////////                                                                function addTextFrame(page, script_label){                                                                var pos  = "";                                                                  var hand = page.side                                                                var boundW = page.properties.bounds[3];                                                                var boundH = page.properties.bounds[2];                                                                var topMargin = page.marginPreferences.top;                                                                var bottomMargin = page.marginPreferences.bottom;                                                                var leftMargin = page.marginPreferences.left;                                                                var frameWidth = app.activeDocument.pages[0].properties.bounds[3] - leftMargin;                                                                                                                                if (hand == PageSideOptions.LEFT_HAND)                                                                         pos =  leftMargin;                                                                if (hand == PageSideOptions.RIGHT_HAND)                                                                         pos = boundW - boundW/2 + leftMargin;                                                                if (page.name == 1)                                                                         pos = leftMargin;                                                                                                            var textFrame = page.textFrames.add({geometricBounds:[0, 0, boundH - topMargin - bottomMargin, frameWidth/2]});                                                                textFrame.move( [pos, topMargin] );                                                                textFrame.label = script_label;                                                                return textFrame;                                                                }                                                                                                                              function selectWhere(value, key, array){                                                                var i = array.length; var t; var filtered = [];                                                                    while(i--){                                                                    t = array[i];                                                                        if(t && t[key] == value && t.contents==0){                                                                            filtered.push(t);                                                                 }                                                                 }                                                                    return filtered;                                                                }                                                            function toArray(objects){                                                                var i = objects.length;                                                                 var array = [];                                                                while(i--){                                                                        array.push(objects[i]);                                                                }                                                                return array;                                                            }                                                            function countTheseElements(xmlfrag, xpath){                                                            var c = 0;                                                            for(x=0; x < xmlfrag.length;x++)                                                                {                                                                    $.writeln(xmlfrag[x].xmlElement[0].length);                                                                                                                                        }                                                                                                                                                                                                                      };